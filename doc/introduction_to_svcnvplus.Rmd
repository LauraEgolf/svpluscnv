---
title: "Introduction to svcnvplys"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to svcnvplys}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r include=FALSE}
require(taRifx)
require(data.table)
require(tidyr)
require(circlize)
require(GenomicRanges)
require(D3GB)
```

svncvplut is a package designed for downstream analyses involving DNA copy number and other structural variants;

Two data types are allowed


## Data input format

To explore the basic functionalities of svcnvplus, we'll use `svcnvplus::brca.ccle.seg` and `svcnvplus::brca.ccle.sv`. This data.frames contain information about CNV segments and structural variants respectively for a breast cancer derived cell line. This data was obtained from <https://depmap.org/portal/download/>. Both data.frames are lazy loaded with `svcnvplus`

```{r message=FALSE}
library(svcnvplus)
dim(brca.ccle.seg)
head(brca.ccle.seg)

dim(brca.ccle.sv)
head(brca.ccle.sv)
```

## Validate data types

* `validate.seg()` check format for segmentation data.frame
* `validate.sv()` chrek format of a Structural variant data.frame

### Validate segmentation data `validate.seg()`

This function will check that the input is a data.frame where columns 1 to 6 meet the following format:


```{r}
segdf <- validate.seg(brca.ccle.seg)
```


### Validate structural variant data `validate.sv()`
```{r}
svdf <- validate.sv(brca.ccle.sv)
```


## 

Copy number are essentialy a subset of all structural variants; Both CNV and structural variant calls are orthogonal and complementary data types. The function `match.variant.breaks` helps identifying breakpoints in common

```{r message=FALSE}
common.breaks <- match.variant.breaks(segdf,svdf,maxgap=50000,low.cov = NULL,verbose=FALSE)

dev.new()
par(mfrow=c(1,2),mar=c(3,9,2,1))
restab <- data.frame(common.breaks$restab)[order(common.breaks$restab$total.seg),]

m1 <- mean(restab$matched.seg/restab$total.seg)
barplot(rbind(restab$matched.seg,restab$total.seg - restab$matched.seg),
        border=NA, las=1, xlab="", horiz=T, cex.main=.7,cex.names=.7, names=rownames(restab),
        main=paste("CNV breaks matched by SV breaks\n","Average =",m1))
grid(ny=NA,nx=NULL)
m2 <- mean(restab$matched.sv/restab$total.sv)
barplot(rbind(restab$matched.sv,restab$total.sv - restab$matched.sv),
        border=NA,las=1,xlab="",horiz=T,cex.main=.7,cex.names=.7, names=rownames(restab),
        main=paste("SV breaks matched by CNV breaks\n","Average =",m2))
grid(ny=NA,nx=NULL)
```

<img src="matching_breaks.png" alt="My Image" style="width:600px"> 

